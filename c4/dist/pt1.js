!function(){"use strict";var e={};e.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),e.slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var l,o=e[Symbol.iterator]();!(a=(l=o.next()).done)&&(r.push(l.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var t={handlers:{ptr:['<a href="$rw@target">$@target</a>'],ref:['<a href="$rw@target">',"</a>"],graphic:function(){var e=this;return function(){var t=e.createShadowRoot();this.addShadowStyle(t);var r=new Image;r.src=e.rw(this.getAttribute("url")),this.hasAttribute("width")&&(r.width=this.getAttribute("width").replace(/[^.0-9]/g,"")),this.hasAttribute("height")&&(r.height=this.getAttribute("height").replace(/[^.0-9]/g,"")),t.appendChild(r)}},table:function(){var e=this;return function(){var t=this.createShadowRoot();e.addShadowStyle(t);var r=document.createElement("table");if(r.innerHTML=this.innerHTML,"tei-head"==r.firstElementChild.localName){var a=r.firstElementChild;a.remove();var n=document.createElement("caption");n.innerHTML=a.innerHTML,r.appendChild(n)}var i=!0,l=!1,o=void 0;try{for(var s,c=Array.from(r.querySelectorAll("tei-row"))[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var d=s.value,h=document.createElement("tr");h.innerHTML=d.innerHTML;var u=!0,f=!1,v=void 0;try{for(var y,m=Array.from(d.attributes)[Symbol.iterator]();!(u=(y=m.next()).done);u=!0){var p=y.value;h.setAttribute(p.name,p.value)}}catch(e){f=!0,v=e}finally{try{!u&&m.return&&m.return()}finally{if(f)throw v}}d.parentElement.replaceChild(h,d)}}catch(e){l=!0,o=e}finally{try{!i&&c.return&&c.return()}finally{if(l)throw o}}var g=!0,b=!1,w=void 0;try{for(var A,T=Array.from(r.querySelectorAll("tei-cell"))[Symbol.iterator]();!(g=(A=T.next()).done);g=!0){var E=A.value,L=document.createElement("td");E.hasAttribute("cols")&&L.setAttribute("colspan",E.getAttribute("cols")),L.innerHTML=E.innerHTML;var x=!0,S=!1,M=void 0;try{for(var k,H=Array.from(E.attributes)[Symbol.iterator]();!(x=(k=H.next()).done);x=!0){var C=k.value;L.setAttribute(C.name,C.value)}}catch(e){S=!0,M=e}finally{try{!x&&H.return&&H.return()}finally{if(S)throw M}}E.parentElement.replaceChild(L,E)}}catch(e){b=!0,w=e}finally{try{!g&&T.return&&T.return()}finally{if(b)throw w}}t.appendChild(r)}},egXML:function(){var e=this;return function(){var t=this.createShadowRoot();e.addShadowStyle(t),t.innerHTML="<pre>"+e.serialize(this,!0)+"</pre>"}}},fallbacks:{ref:function(e){var t=this;e.addEventListener("click",function(r){window.location=t.rw(e.getAttribute("target"))})},graphic:function(e){var t=new Image;t.src=this.rw(this.getAttribute("url")),e.hasAttribute("width")&&(t.width=e.getAttribute("width").replace(/[^.0-9]/g,"")),e.hasAttribute("height")&&(t.height=e.getAttribute("height").replace(/[^.0-9]/g,"")),e.appendChild(t)},table:function(e){var t=document.createElement("table");if(t.innerHTML=e.innerHTML,"tei-head"==t.firstElementChild.localName){var r=t.firstElementChild;r.remove();var a=document.createElement("caption");a.innerHTML=r.innerHTML,t.appendChild(a)}var n=!0,i=!1,l=void 0;try{for(var o,s=Array.from(t.querySelectorAll("tei-row"))[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value,d=document.createElement("tr");d.innerHTML=c.innerHTML;var h=!0,u=!1,f=void 0;try{for(var v,y=Array.from(c.attributes)[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var m=v.value;d.setAttribute(m.name,m.value)}}catch(e){u=!0,f=e}finally{try{!h&&y.return&&y.return()}finally{if(u)throw f}}c.parentElement.replaceChild(d,c)}}catch(e){i=!0,l=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw l}}var p=!0,g=!1,b=void 0;try{for(var w,A=Array.from(t.querySelectorAll("tei-cell"))[Symbol.iterator]();!(p=(w=A.next()).done);p=!0){var T=w.value,E=document.createElement("td");T.hasAttribute("cols")&&E.setAttribute("colspan",T.getAttribute("cols")),E.innerHTML=T.innerHTML;var L=!0,x=!1,S=void 0;try{for(var M,k=Array.from(T.attributes)[Symbol.iterator]();!(L=(M=k.next()).done);L=!0){var H=M.value;E.setAttribute(H.name,H.value)}}catch(e){x=!0,S=e}finally{try{!L&&k.return&&k.return()}finally{if(x)throw S}}T.parentElement.replaceChild(E,T)}}catch(e){g=!0,b=e}finally{try{!p&&A.return&&A.return()}finally{if(g)throw b}}e.innerHTML='<span style="display:none">'+e.innerHTML+"</span>",e.appendChild(t)},egXML:function(e){var t=this.serialize(e,!0);e.innerHTML='<span style="display:none">'+e.innerHTML+"</span>",e.innerHTML+="<pre>"+t+"</pre>"}}},r=function(){function r(a){if(e.classCallCheck(this,r),this.els=[],this.behaviors=[],this.hasStyle=!1,this.prefixes=[],a)this.base=a;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch(e){this.base=""}this.behaviors.push(t),this.shadowCSS}return e.createClass(r,[{key:"getHTML5",value:function(e,t,r){var a=this;return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.send(),a.onload=function(){this.status>=200&&this.status<300?t(this.response):r(this.statusText)},a.onerror=function(){r(this.statusText)}}).catch(function(e){console.log(e)}).then(function(e){return a.makeHTML5(e,t,r)})}},{key:"makeHTML5",value:function(e,t,r){var a=this,n=(new DOMParser).parseFromString(e,"text/xml");this._fromTEI(n);if(this.dom=function e(t){var n=void 0,i=!1;switch(t.namespaceURI){case"http://www.tei-c.org/ns/1.0":n=document.createElement("tei-"+t.tagName);break;case"http://www.tei-c.org/ns/Examples":if("egXML"==t.tagName){n=document.createElement("teieg-"+t.tagName);break}default:n=document.importNode(t,!1),i=!0}var l=!0,o=!1,s=void 0;try{for(var c,d=Array.from(t.attributes)[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var h=c.value;"xmlns"!=h.name||i?n.setAttribute(h.name,h.value):n.setAttribute("data-xmlns",h.value),"xml:id"!=h.name||i||n.setAttribute("id",h.value),"xml:lang"!=h.name||i||n.setAttribute("lang",h.value),"rendition"==h.name&&n.setAttribute("class",h.value.replace(/#/g,""))}}catch(e){o=!0,s=e}finally{try{!l&&d.return&&d.return()}finally{if(o)throw s}}if(n.setAttribute("data-teiname",t.localName),"tagsDecl"==t.localName){var u=document.createElement("style"),f=!0,v=!1,y=void 0;try{for(var m,p=Array.from(t.childNodes)[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){var g=m.value;if(g.nodeType==Node.ELEMENT_NODE&&"rendition"==g.localName&&"css"==g.getAttribute("scheme")){var b="";g.hasAttribute("selector")?(b+=g.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+"{\n",b+=g.textContent):(b+="."+g.getAttribute("xml:id")+"{\n",b+=g.textContent),b+="\n}\n",u.appendChild(document.createTextNode(b))}}}catch(e){v=!0,y=e}finally{try{!f&&p.return&&p.return()}finally{if(v)throw y}}u.childNodes.length>0&&(n.appendChild(u),a.hasStyle=!0)}"prefixDef"==t.localName&&(a.prefixes.push(t.getAttribute("ident")),a.prefixes[t.getAttribute("ident")]={matchPattern:t.getAttribute("matchPattern"),replacementPattern:t.getAttribute("replacementPattern")});var w=!0,A=!1,T=void 0;try{for(var E,L=Array.from(t.childNodes)[Symbol.iterator]();!(w=(E=L.next()).done);w=!0){var x=E.value;x.nodeType==Node.ELEMENT_NODE?n.appendChild(e(x)):n.appendChild(x.cloneNode())}}catch(e){A=!0,T=e}finally{try{!w&&L.return&&L.return()}finally{if(A)throw T}}return r&&r(n),n}(n.documentElement),document.registerElement?this.registerAll(this.els):this.fallback(this.els),this.done=!0,!t)return this.dom;t(this.dom,this)}},{key:"addStyle",value:function(e,t){this.hasStyle&&e.getElementsByTagName("head").item(0).appendChild(t.getElementsByTagName("style").item(0).cloneNode(!0))}},{key:"addShadowStyle",value:function(e){this.shadowCSS&&(e.innerHTML='<style>@import url("'+this.shadowCSS+'");</style>'+e.innerHTML)}},{key:"addBehaviors",value:function(e){e.handlers||e.fallbacks?this.behaviors.push(e):console.log("No handlers or fallback methods found.")}},{key:"setBaseUrl",value:function(e){this.base=e}},{key:"_fromTEI",value:function(e){var t=e.documentElement;this.els=new Set(Array.from(t.getElementsByTagName("*"),function(e){return e.tagName})),this.els.add(t.tagName)}},{key:"_insert",value:function(e,t){if(e.createShadowRoot){var r=e.createShadowRoot();this.addShadowStyle(r),r.innerHTML+=t[0]+e.innerHTML+(t[1]?t[1]:"")}else{t.length>1?t[0].includes("<")&&t[1].includes("</")?e.innerHTML=t[0]+e.innerHTML+t[1]:e.innerHTML="<span>"+t[0]+"</span>"+e.innerHTML+"<span>"+t[1]+"</span>":t[0].includes("<")?e.innerHTML=t[0]+e.innerHTML:e.innerHTML="<span>"+t[0]+"</span>"+e.innerHTML}}},{key:"_template",value:function(e,t){var r=e;if(e.search(/$(\w*)@(\w+)/))for(var a=/\$(\w*)@(\w+)/g,n=void 0;n=a.exec(e);)t.hasAttribute(n[2])&&(r=n[1]&&this[n[1]]?r.replace(n[0],this[n[1]].call(this,t.getAttribute(n[2]))):r.replace(n[0],t.getAttribute(n[2])));return r}},{key:"tagName",value:function(e){return"egXML"==e?"teieg-"+e:"tei-"+e}},{key:"decorator",value:function(e){return function(){var t=this;return function(r){var a=[];this!=t&&(r=this);for(var n=0;n<e.length;n++)a.push(t._template(e[n],r));t._insert(r,a)}}}},{key:"getHandler",value:function(e){for(var t=this.behaviors.length-1;t>=0;t--)if(this.behaviors[t].handlers[e])return Array.isArray(this.behaviors[t].handlers[e])?this.decorator(this.behaviors[t].handlers[e]):this.behaviors[t].handlers[e]}},{key:"getFallback",value:function(e){for(var t=this.behaviors.length-1;t>=0;t--){if(this.behaviors[t].fallbacks[e])return Array.isArray(this.behaviors[t].fallbacks[e])?this.decorator(this.behaviors[t].fallbacks[e]).call(this):this.behaviors[t].fallbacks[e];if(this.behaviors[t].handlers[e]&&Array.isArray(this.behaviors[t].handlers[e]))return this.decorator(this.behaviors[t].handlers[e]).call(this);if(this.behaviors[t].handlers[e]&&1==this.behaviors[t].handlers[e].call(this).length)return this.behaviors[t].handlers[e].call(this)}}},{key:"registerAll",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value,o=Object.create(HTMLElement.prototype),s=this.getHandler(l);s&&(o.createdCallback=s.call(this));var c=this.tagName(l);try{document.registerElement(c,{prototype:o})}catch(e){console.log(c+" couldn't be registered or is already registered."),console.log(e)}}}catch(e){r=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw a}}}},{key:"fallback",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value,o=this.getFallback(l);if(o){var s=!0,c=!1,d=void 0;try{for(var h,u=Array.from(this.dom.getElementsByTagName(this.tagName(l)))[Symbol.iterator]();!(s=(h=u.next()).done);s=!0){var f=h.value;o.call(this,f)}}catch(e){c=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(c)throw d}}}}}catch(e){r=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw a}}}},{key:"rw",value:function(e){return e.match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+e}},{key:"first",value:function(e){return e.replace(/ .*$/,"")}},{key:"serialize",value:function(e,t){var r="";if(!t){r+="&lt;"+e.getAttribute("data-teiname");var a=!0,n=!1,i=void 0;try{for(var l,o=Array.from(e.attributes)[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){var s=l.value;s.name.startsWith("data-")||["id","lang","class"].includes(s.name)||(r+=" "+s.name+'="'+s.value+'"')}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}e.childNodes.length>0?r+=">":r+="/>"}var c=!0,d=!1,h=void 0;try{for(var u,f=Array.from(e.childNodes)[Symbol.iterator]();!(c=(u=f.next()).done);c=!0){var v=u.value;v.nodeType==Node.ELEMENT_NODE?r+=this.serialize(v):r+=v.nodeValue}}catch(e){d=!0,h=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw h}}return!t&&e.childNodes.length>0&&(r+="&lt;"+e.getAttribute("data-teiname")+">"),r}},{key:"fromODD",value:function(){}}]),r}();try{window&&(window.CETEI=r)}catch(e){}var a=function(t){var r=$(t),a=r.find("tei-zone[type=main]");r.find("tei-line:has(tei-add[place=superlinear])").css("margin-top",".5em"),r.find("tei-line:has(tei-add[place=sublinear])").each(function(t,r){var a=$(r);a.css("margin-bottom",".5em");var i=a.find("tei-add[place=sublinear]"),l=!0,o=!1,s=void 0;try{for(var c,d=Array.from(i).entries()[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var h=e.slicedToArray(c.value,2),u=h[0],f=h[1],v=i[u-1];if(null!=v){var y=v.getBoundingClientRect(),m=f.getBoundingClientRect();if(n(y,m)){var p=y.right-m.left;$(f).css("padding-left",p+10+"px")}if($(f).closest("tei-add").length>0){var g=parseInt(a.css("padding-top").replace(/^(\d+).*?$/,"$1"));a.css("padding-top",g+10+"px")}}}}catch(e){o=!0,s=e}finally{try{!l&&d.return&&d.return()}finally{if(o)throw s}}}),r.find("tei-line:has(tei-add[place=superlinear])").each(function(t,r){var a=$(r);a.css("margin-top",".5em");var i=a.find("tei-add[place=superlinear]"),l=!0,o=!1,s=void 0;try{for(var c,d=Array.from(i).entries()[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var h=e.slicedToArray(c.value,2),u=h[0],f=h[1],v=i[u-1];if(null!=v){var y=v.getBoundingClientRect(),m=f.getBoundingClientRect();if(n(y,m)){var p=y.right-m.left;$(f).css("padding-left",p+10+"px")}if($(f).closest("tei-add").length>0){var g=parseInt(a.css("padding-top").replace(/^(\d+).*?$/,"$1"));a.css("padding-top",g+10+"px")}}}}catch(e){o=!0,s=e}finally{try{!l&&d.return&&d.return()}finally{if(o)throw s}}});var i=r.find("tei-zone[type=left_margin]");i.length>0&&a.css("margin-left","10em"),i.css("margin-top",a.position().top),i.each(function(e,t){$(t).css("top",e*(100/i.length)+"%")});var l=r.find("tei-line"),o=0;l.each(function(e,t){var r=$(t).clone().children().remove().end().text().length;o=r>o?r:o}),$("tei-line[rend='center']").each(function(e,t){$(t).css("padding-left",(o-$(t).text().length)/2+"ex")});var s=r.width()/10;$("tei-line[rend^='indent']").each(function(e,t){var r=/^indent(\d+)/.exec($(t).attr("rend"))[1],a=parseInt(r)*s;$(t).css("padding-left",a)})},n=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},i="1",l=window.location.hash.substring(window.location.hash.indexOf("#")+1);""!=l&&(i=l),function(t,n){var i=Mirador({id:"IIIF",layout:"1x1",mainMenuSettings:{show:!1},data:[{manifestUri:t,location:"University of Maryland"}],windowObjects:[{loadedManifest:t,viewType:"ImageView",displayLayout:!1,bottomPanel:!1,sidePanel:!1,annotationLayer:!1}],annotationEndpoint:{name:"Local Storage",module:"LocalStorageEndpoint"}}),l=function(e){i.viewer.workspace.windows[0].setCurrentCanvasID(e),s(e)};i.eventEmitter.subscribe("windowAdded",function(t,r){var a=i.viewer.workspace.windows[0],o="",s=!0,c=!1,d=void 0;try{for(var h,u=Array.from(a.imagesList).entries()[Symbol.iterator]();!(s=(h=u.next()).done);s=!0){var f=e.slicedToArray(h.value,2),v=f[0],y=f[1];$("#pages").append("<a class='dropdown-item' href='#"+(v+1)+"'>"+y.label+"</a>"),v+1==n&&($("#cur_page").text(y.label),o=y["@id"])}}catch(e){c=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(c)throw d}}var m=!1;i.eventEmitter.subscribe("windowUpdated",function(){m||(m=!0,l(o))}),window.onhashchange=function(){var t=window.location.hash.substring(window.location.hash.indexOf("#")+1);""!=t&&(n=t);var r=!0,i=!1,o=void 0;try{for(var s,c=Array.from(a.imagesList).entries()[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var d=e.slicedToArray(s.value,2),h=d[0],u=d[1];if($("#pages").append("<a class='dropdown-item' href='#"+(h+1)+"'>"+u.label+"</a>"),h+1==n){n=u["@id"],$("#cur_page").text(u.label),l(n);break}}}catch(e){i=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}},$("#mnext").click(function(t){var r=!0,n=!1,i=void 0;try{for(var l,o=Array.from(a.imagesList).entries()[Symbol.iterator]();!(r=(l=o.next()).done);r=!0){var s=e.slicedToArray(l.value,2),c=s[0];if(s[1]["@id"]==a.canvasID){a.imagesList[c+1]["@id"],window.location.hash="#"+(c+2);break}}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}}),$("#mprev").click(function(t){var r=!0,n=!1,i=void 0;try{for(var l,o=Array.from(a.imagesList).entries()[Symbol.iterator]();!(r=(l=o.next()).done);r=!0){var s=e.slicedToArray(l.value,2),c=s[0];if(s[1]["@id"]==a.canvasID){a.imagesList[c-1]["@id"],$("#cur_page").text(a.imagesList[c+1].label),window.location.hash="#"+c;break}}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}})}),i.eventEmitter.subscribe("windowUpdated",function(){$(".mirador-osd-next").remove(),$(".mirador-osd-previous").remove()}),console.log(i);var o=new r,s=function(e){$("#TEI").children().unbind(),$("#TEI").unbind(),$("#TEI").empty(),o.getHTML5(e,function(e){document.getElementById("TEI").innerHTML="",document.getElementById("TEI").appendChild(e),a(e)})}}("manifests/ox-ms_shelley_adds_c4_vs.json",i)}();